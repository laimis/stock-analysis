<div class="container-fluid mt-3">
  <div class="row mb-3">
    <div class="col-md-6">
      <h3>Stock Price Alerts</h3>
    </div>
    <div class="col-md-6 text-end">
      <button class="btn btn-primary" (click)="toggleForm()">
        <i class="fas" [ngClass]="{'fa-plus': !showForm, 'fa-times': showForm}"></i>
        {{ showForm ? 'Cancel' : 'New Alert' }}
      </button>
      <button class="btn btn-secondary ms-2" (click)="loadAlerts()" [disabled]="loading">
        <i class="fas fa-sync" [ngClass]="{'fa-spin': loading}"></i>
        Refresh
      </button>
    </div>
  </div>

  @if (errors.length > 0) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      @for (error of errors; track error) {
        <div>{{ error }}</div>
      }
      <button type="button" class="btn-close" (click)="errors = []"></button>
    </div>
  }

  @if (showForm) {
    <app-price-alert-form
      [editingAlert]="editingAlert"
      [showTickerField]="true"
      [loading]="loading"
      [errors]="errors"
      (save)="onPriceAlertSave($event)"
      (cancelled)="toggleForm()">
    </app-price-alert-form>
  }

  <div class="mb-3 d-flex align-items-center justify-content-between">
    <select 
      id="filterState" 
      class="form-select w-auto" 
      [(ngModel)]="filterState" 
      (change)="onFilterChange()">
      <option value="all">All States ({{ alerts.length }})</option>
      <option value="active">Active</option>
      <option value="triggered">Triggered</option>
      <option value="disabled">Disabled</option>
    </select>
    
    <input 
      type="text" 
      id="filterTicker" 
      class="form-control" 
      placeholder="Search by ticker..." 
      [(ngModel)]="filterTicker" 
      (input)="onFilterChange()"
      style="width: 200px;">
  </div>

  <app-price-alert-list
    [alerts]="filteredAlerts"
    [loading]="loading && alerts.length === 0"
    [showTickerColumn]="true"
    [emptyMessage]="'No alerts found. Create your first alert to get started!'"
    (edit)="editAlert($event)"
    (delete)="deleteAlert($event)"
    (resetAlert)="resetAlertState($event)">
  </app-price-alert-list>
</div>
