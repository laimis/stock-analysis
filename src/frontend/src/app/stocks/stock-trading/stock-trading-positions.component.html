<div class="mt-4">
    @if (positions.length > 0) {
        <div class="table-responsive">
            <table class="table table-modern table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col" class="ps-4 sortable" style="width: 120px;" (click)="sortBy('ticker')" role="button">
                            Ticker <i class="bi" [ngClass]="getSortIcon('ticker')"></i>
                        </th>
                        <th scope="col" class="text-end sortable" (click)="sortBy('price')" role="button">
                            Price <i class="bi" [ngClass]="getSortIcon('price')"></i>
                        </th>
                        <th scope="col" class="text-end sortable" (click)="sortBy('avgCost')" role="button">
                            Cost Basis <i class="bi" [ngClass]="getSortIcon('avgCost')"></i>
                        </th>
                        <th scope="col" class="text-end sortable" (click)="sortBy('unrealizedGainLoss')" role="button">
                            Unrealized Gain/Loss <i class="bi" [ngClass]="getSortIcon('unrealizedGainLoss')"></i>
                        </th>
                        <th scope="col" class="text-end sortable" (click)="sortBy('cost')" role="button">
                            Cost <i class="bi" [ngClass]="getSortIcon('cost')"></i>
                        </th>
                        <th scope="col" class="text-center" style="width: 60px;">Details</th>
                    </tr>
                </thead>
                <tbody>
                    @for (position of positions; track position.ticker) {
                        <tr class="cursor-pointer" (click)="toggleDetails(position.ticker)">
                            <td class="ps-4 py-3">
                                <app-stock-link-and-tradingview-link [ticker]="position.ticker"></app-stock-link-and-tradingview-link>
                            </td>
                            <td class="text-end py-3">
                                {{ getPrice(position) | currency }}
                            </td>
                            <td class="text-end py-3">
                                <div>{{ position.averageCostPerShare | currency }}</div>
                                <div class="small" [class.text-success]="getPercentGainLoss(position) > 0" [class.text-danger]="getPercentGainLoss(position) < 0">
                                    {{ getPercentGainLoss(position) | percent:'1.2-2' }}
                                </div>
                            </td>
                            <td class="text-end py-3">
                                <span [class.text-success]="getUnrealizedGainLoss(position) > 0" [class.text-danger]="getUnrealizedGainLoss(position) < 0">
                                    {{ getUnrealizedGainLoss(position) | currency }}
                                </span>
                            </td>
                            <td class="text-end py-3">
                                {{ position.cost | currency }}
                            </td>
                            <td class="text-center py-3">
                                <i class="bi" [class.bi-chevron-down]="!isDetailsVisible(position.ticker)" [class.bi-chevron-up]="isDetailsVisible(position.ticker)"></i>
                            </td>
                        </tr>
                        @if (isDetailsVisible(position.ticker)) {
                            <tr class="table-active">
                                <td colspan="6" class="p-0">
                                    <div class="p-4 details-row border-top">
                                        <app-stock-trading-position
                                            [position]="position"
                                            [quote]="getQuote(position)"
                                            [brokerageAccount]="brokerageAccount"
                                            [positionOrders]="getOrdersForPosition(position.ticker)"
                                            (positionChanged)="positionChanged.emit()"></app-stock-trading-position>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    } @else {
        <div class="alert alert-secondary" role="alert">
            <i class="bi bi-info-circle me-2"></i>No open positions
        </div>
    }
</div>
