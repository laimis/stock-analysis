<div class="mt-4">
    @if (positions.length > 0) {
        <div class="table-responsive">
            <table class="table table-modern table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col" class="ps-4">Ticker</th>
                        <th scope="col" class="text-end">Price</th>
                        <th scope="col" class="text-end">Avg Cost/Share</th>
                        <th scope="col" class="text-end">Gain/Loss</th>
                        <th scope="col" class="text-end">Cost</th>
                        <th scope="col" class="text-center">Details</th>
                    </tr>
                </thead>
                <tbody>
                    @for (position of positions; track position.ticker) {
                        <tr>
                            <td class="ps-4 py-3">
                                <app-stock-link [ticker]="position.ticker"></app-stock-link>
                            </td>
                            <td class="text-end py-3">
                                <span class="fw-semibold">{{ getPrice(position) | currency }}</span>
                            </td>
                            <td class="text-end py-3">
                                {{ position.averageCostPerShare | currency }}
                            </td>
                            <td class="text-end py-3">
                                <span [class.text-success]="position.gainPct > 0" [class.text-danger]="position.gainPct < 0" class="fw-semibold">
                                    {{ position.gainPct | percent:'1.2-2' }}
                                </span>
                            </td>
                            <td class="text-end py-3">
                                {{ position.cost | currency }}
                            </td>
                            <td class="text-center py-3">
                                <button 
                                    type="button" 
                                    class="btn btn-sm btn-outline-info btn-details"
                                    (click)="toggleDetails(position.ticker)">
                                    <i class="bi" [class.bi-chevron-down]="!isDetailsVisible(position.ticker)" [class.bi-chevron-up]="isDetailsVisible(position.ticker)"></i>
                                    Details
                                </button>
                            </td>
                        </tr>
                        @if (isDetailsVisible(position.ticker)) {
                            <tr class="table-active">
                                <td colspan="6" class="p-0">
                                    <div class="p-4 details-row border-top">
                                        <app-stock-trading-position
                                            [position]="position"
                                            [quote]="getQuote(position)"
                                            [brokerageAccount]="brokerageAccount"
                                            [positionOrders]="getOrdersForPosition(position.ticker)"
                                            (positionChanged)="positionChanged.emit()"></app-stock-trading-position>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    } @else {
        <div class="alert alert-secondary" role="alert">
            <i class="bi bi-info-circle me-2"></i>No open positions
        </div>
    }
</div>
