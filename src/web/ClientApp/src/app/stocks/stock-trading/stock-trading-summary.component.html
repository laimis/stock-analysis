
  <div>
    <div class="row">
      <div class="col-md mb-4 mt-2 text-center">
        <div class="text-muted sort-header" >
          Long Invested
        </div>
        <div class="fs-4 summary-card-main-info">
          {{ totalLongCost | currency }}
        </div>
      </div>
      <div class="col-md mb-4 mt-2 text-center">
        <div class="text-muted">
          Short Invested
        </div>
        <div class="fs-4 summary-card-main-info">
          {{ totalShortCost | currency }}
        </div>
      </div>
      <div class="col-md mb-4 mt-2 text-center">
        <div class="text-muted">
          Positions Long / Short
        </div>
        <div class="fs-4 summary-card-main-info">
          {{longPositions.length}} / {{shortPositions.length}}
        </div>
      </div>
      <div class="col-md mb-4 mt-2 text-center">
        <div class="text-muted">
          Profit
        </div>
        <div class="fs-4 summary-card-main-info">
          {{ totalProfit | currency}}
        </div>
      </div>
      <div class="col-md mb-4 mt-2 text-center">
        <div class="text-muted">
          Cash
        </div>
        <div class="fs-4 summary-card-main-info">
          {{ brokerageAccount.cashBalance | currency}}
        </div>
      </div>
    </div>
    @if (positionGroups) {
    <table class="table table-hover d-none d-md-table">
      <thead>
        <tr>
          <th class="sort-header" (click)="sort('strategy')">Strategy</th>
          <th class="sort-header" (click)="sort('profit')">Profit</th>
          <th class="sort-header" (click)="sort('cost')">Invested</th>
          <th class="sort-header" (click)="sort('risk')">Risked</th>
          <th class="sort-header" (click)="sort('numberOfPositions')">Positions</th>
          <th class="sort-header" (click)="sort('gain')">Gain %</th>
        </tr>
      </thead>
      <tbody>
        @for (positionGroup of positionGroups; track positionGroup) {
          <tr>
            <td>{{positionGroup.strategy}}</td>
            <td>{{positionGroup.profit | currency}}</td>
            <td>{{ positionGroup.cost | currency }}</td>
            <td>{{ positionGroup.risk | currency }}</td>
            <td>{{positionGroup.length}}</td>
            <td>{{ (positionGroup.profit / positionGroup.cost) | percent:'1.0-2' }}</td>
          </tr>
        }
      </tbody>
    </table>
    <div class="d-md-none">
      @for (positionGroup of positionGroups; track positionGroup) {
        <div class="card mb-3">
          <div class="card-body">
            <h5 class="card-title">Strategy: {{positionGroup.strategy}}</h5>
            <div class="row">
              <div class="col-md mb-4 mt-2 text-center">
                <div class="text-muted">
                  Profit
                </div>
                <div class="fs-4 summary-card-main-info">
                  {{ positionGroup.profit | currency}}
                </div>
              </div>
              <div class="col-md mb-4 mt-2 text-center">
                <div class="text-muted">
                  Cost
                </div>
                <div class="fs-4 summary-card-main-info">
                  {{ positionGroup.cost | currency}}
                </div>
              </div>
              <div class="col-md mb-4 mt-2 text-center">
                <div class="text-muted">
                  Risk
                </div>
                <div class="fs-4 summary-card-main-info">
                  {{ positionGroup.risk | currency}}
                </div>
              </div>
              <div class="col-md mb-4 mt-2 text-center">
                <div class="text-muted">
                  Trades
                </div>
                <div class="fs-4 summary-card-main-info">
                  {{ positionGroup.length}}
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
    }
      
      <section>
          <h3>Brokerage Information</h3>
          @if (brokerageAccount && brokerageAccount.connected) {
              <div>
                  <div class="row">
                      <div class="col-md mb-4 mt-2 text-center">
                          <div class="text-muted sort-header" >
                              Equity
                          </div>
                          <div class="fs-4 summary-card-main-info">
                              {{ brokerageAccount.equity | currency }}
                          </div>
                      </div>
                      <div class="col-md mb-4 mt-2 text-center">
                          <div class="text-muted">
                              Long Value
                          </div>
                          <div class="fs-4 summary-card-main-info">
                              {{ brokerageAccount.longMarketValue | currency }}
                          </div>
                      </div>
                      <div class="col-md mb-4 mt-2 text-center">
                          <div class="text-muted">
                              Short Value
                          </div>
                          <div class="fs-4 summary-card-main-info">
                              {{brokerageAccount.shortMarketValue | currency}}
                          </div>
                      </div>
                      <div class="col-md mb-4 mt-2 text-center">
                          <div class="text-muted">
                              Cash
                          </div>
                          <div class="fs-4 summary-card-main-info" *ngIf="brokerageAccount && brokerageAccount.connected">
                              {{ brokerageAccount.cashBalance | currency}}
                          </div>
                          <div class="fs-4 summary-card-main-info" *ngIf="!brokerageAccount || !brokerageAccount.connected">
                              N/A
                          </div>
                      </div>
                  </div>
                  <table class="table table-hover">
                      <thead>
                      <tr>
                          <th class="sort-header" (click)="sortBrokerageTable('ticker')">Ticker</th>
                          <th class="sort-header" (click)="sortBrokerageTable('averageCost')">Average Cost</th>
                          <th class="sort-header" (click)="sortBrokerageTable('quantity')">Quantity</th>
                          <th class="sort-header text-end" (click)="sortBrokerageTable('total')">Total</th>
                      </tr>
                      </thead>
                      <tbody>
                          @for (position of brokerageAccount.stockPositions; track position.ticker) {
                              <tr>
                                  <td><app-stock-link-and-tradingview-link [ticker]="position.ticker"></app-stock-link-and-tradingview-link></td>
                                  <td>{{position.averageCost | currency}}</td>
                                  <td>{{position.quantity}}</td>
                                  <td class="text-end">{{position.averageCost * position.quantity | currency}}</td>
                              </tr>
                          }
                      </tbody>
                  </table>
              </div>
          }
      </section>
      
  </div>
