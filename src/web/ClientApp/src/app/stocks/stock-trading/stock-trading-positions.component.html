<div>
  <div class="row">
    <div class="col">
      <div class="row">
        <div class="col"><a class="btn btn-link me-1" href="/api/stocks/export/open">Export</a></div>
        <div class="col"><button class="btn btn-link me-1" (click)="toggleRenderStyle()">{{renderStyleName}}</button></div>
      </div>
    </div>
    <div class="col">
      <div class="row">
        <label for="strategyToFilter" class="text-end col-sm-2 col-form-label col-form-label-sm">Strategy</label>
        <div class="col-sm-10">
          <select class="form-select" name="strategyToFilter" id="strategyToFilter" (change)="strategyToFilterChanged($event.target)">
            @for (so of strategies; track so) {
              <option value="{{so.key}}" [selected]="so.key === strategyToFilter">{{so.value}}</option>
            }
          </select>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="row">
        <label for="metricToRender" class="text-end col-sm-2 col-form-label col-form-label-sm">Sort by</label>
        <div class="col-sm-10">
          <select class="form-select" name="metricToRender" id="metricToRender" (change)="metricChanged($event.target)">
            @for (so of sortOptions; track so.value) {
              <option value="{{so.value}}">{{so.name}}</option>
            }
          </select>
        </div>
      </div>
    </div>
  </div>
  @if (renderStyle === 'card') {
    <div>
      @for (position of sortedPositions; track position.ticker) {
        <div class="card border-info mt-4">
          <div class="card-body">
            <div class="card-title">
              <div class="container">
                <div class="row">
                  <div class="col">
                    <app-stock-link class="position-ticker" [ticker]="position.ticker"></app-stock-link>
                    <span class="position-price">{{getPrice(position) | currency}}</span>
                    <i
                      (click)="toggleVisibility(detailDiv); toggleVisibility(positionNotesDiv)"
                    class="bi bi-info-square-fill ms-2"></i>
                  </div>
                  <div class="col text-center">
                  </div>
                  <div class="col">
                    <span class="position-gain float-end">{{ getMetricToRender(position) }}</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-text" #positionNotesDiv>
              @for (note of position.notes; track note) {
                <div class="position-note">
                  <span class="position-note-date">{{note.date | date}}</span>
                  <span class="position-note-text">{{note.text}}</span>
                </div>
              }
            </div>
            <div class="card-text visually-hidden" #detailDiv>
              <app-stock-trading-position [position]="position" [orders]="orders" [quote]="getQuote(position)" ></app-stock-trading-position>
            </div>
          </div>
        </div>
      }
    </div>
  }
  @if (renderStyle === 'table') {
    <div>
      <table class="table table-hover striped">
        <thead>
          <tr>
            <th>Ticker</th>
            <th>Price</th>
            <th>Cost/Share</th>
            <th>Stop</th>
            <th>Cost</th>
            <th>Shares</th>
            <th>P/L</th>
            <th>Risked</th>
            <th>R/R</th>
            <th>Opened</th>
            <th>Last tx Age</th>
          </tr>
        </thead>
        <tbody>
          @for (position of sortedPositions; track position) {
            <tr>
              <td>
                <app-stock-link-and-tradingview-link [ticker]="position.ticker"></app-stock-link-and-tradingview-link>
              </td>
              <td>{{getPrice(position) | currency}}</td>
              <td>{{position.averageCostPerShare | currency}}</td>
              <td>{{position.stopPrice | currency}}</td>
              <td>{{position.cost | currency}}</td>
              <td>{{position.numberOfShares}}</td>
              <td>{{position.profit}}</td>
              <td>{{position.riskedAmount | currency}}</td>
              <td>{{position.rr | number}}</td>
              <td>{{position.opened | date}}</td>
              <td>{{position.daysSinceLastTransaction}}</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
