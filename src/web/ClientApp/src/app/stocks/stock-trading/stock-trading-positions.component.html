<div>
  <div class="row">
    <div class="col">
      <a class="btn btn-link me-2" href="/api/stocks/export/open">Export</a>
      <button class="btn btn-link me-2" (click)="toggleRenderStyle()">{{renderStyleName}}</button>
      <button class="btn btn-link me-2" (click)="toggleExcludeLongTerm()">{{excludeLongTermName}}</button>
    </div>
    <label for="metricToRender" class="text-end col-sm-2 col-form-label">Sort by</label>
    <div class="col">  
      <select class="form-select" name="metricToRender" id="metricToRender" (click)="metricChanged($event.target)">
        <option value="rr">R/R</option>
        <option value="pl">P/L</option>
        <option value="unrealizedPL">Unrealized P/L</option>
        <option value="combinedPL">Combined P/L</option>
        <option value="plPercent">P/L %</option>
        <option value="cost">Cost</option>
        <option value="ticker">Ticker</option>
        <option value="percentToStop">% to Stop</option>
        <option value="daysSinceLastTransaction">Days Since Last Transaction</option>
        <option value="riskedAmount">Risked Amount</option>
        <option value="riskedAmountFromStop">Risked Amount from Stop</option>
        <option value="daysHeld">Days Held</option>
      </select>
    </div>
  </div>

  <div *ngIf="renderStyle === 'card'">
    <div class="card border-info mt-4" *ngFor="let position of sortedPositions;">  
      <div class="card-body" *ngIf="position">
        <div class="card-title">
          <div class="container">
            <div class="row">
              <div class="col">
                <a [routerLink]="[ '/stocks', position.ticker ]" class="position-ticker">{{position.ticker}}</a>
                <span class="position-price">{{position.price | currency}}</span>
                <i
                  (click)="toggleVisibility(detailDiv);"
                  class="bi bi-info-square-fill ms-2"></i>
              </div>
              <div class="col text-center">
              </div>
              <div class="col">
                <span class="position-gain float-end">{{ getMetricToRender(position) }}</span>
              </div>
            </div>  
          </div>
        </div>
        <div class="card-text" class="visually-hidden" #detailDiv>
          <app-stock-trading-position [position]="position" [orders]="brokerageOrdersForPosition(position)" ></app-stock-trading-position>
        </div>      
      </div>
    </div>
  </div>

  <div *ngIf="renderStyle === 'table'">
    <table class="table table-hover striped">
      <thead>
        <tr>
          <th>Ticker</th>
          <th>Price</th>
          <th>Cost/Share</th>
          <th>Stop</th>
          <th>Cost</th>
          <th>Shares</th>
          <th>P/L (u)</th>
          <th>% Gain (u)</th>
          <th>R/R (u)</th>
          <th>P/L</th>
          <th>Risked</th>
          <th>R/R</th>
          <th>Opened</th>
          <th>Last tx Age</th>
          <th>% to stop</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let position of sortedPositions">
          <td><a [routerLink]="[ '/stocks', position.ticker ]">{{position.ticker}}</a></td>
          <td>{{position.price | currency}}</td>
          <td>{{position.averageCostPerShare | currency}}</td>
          <td>{{position.stopPrice | currency}}</td>
          <td>{{position.cost | currency}}</td>
          <td>{{position.numberOfShares}}</td>
          <td>{{position.unrealizedProfit| currency}}</td>
          <td>{{position.unrealizedGainPct | percent}}</td>
          <td>{{position.unrealizedRR  | number}}</td>
          <td>{{position.combinedProfit | currency}}</td>
          <td>{{position.riskedAmount | currency}}</td>
          <td>{{position.rr | number}}</td>
          <td>{{position.opened | date}}</td>
          <td>{{position.daysSinceLastTransaction}}</td>
          <td>{{position.percentToStop | percent}}</td>
        </tr>
      </tbody>
    </table>

  </div>
  

</div>