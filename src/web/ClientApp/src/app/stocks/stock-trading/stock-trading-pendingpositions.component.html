<section>
  <h5>Pending Positions</h5>

  <app-error-display *ngIf="errors" [errors]="errors"></app-error-display>


  <div class="d-flex justify-content-end">
    <a class="btn btn-outline-secondary btn-sm" href="{{getPendingPositionExportUrl()}}">Export</a>
  </div>

  <div>
    <span *ngIf="loaded && positions.length === 0">No pending positions found</span>
    <table class="table table-hover" *ngIf="positions.length !== 0">
      <thead>
        <tr>
          <th scope="col">Ticker</th>
          <th scope="col">Shares</th>
          <th scope="col">Bid</th>
          <th scope="col">Price</th>
          <th scope="col">% diff</th>
          <th scope="col">Stop</th>
          <th scope="col">Date</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let position of positions">
          <tr>
            <td>
              <app-stock-link-and-tradingview-link [ticker]="position.ticker" [openInNewTab]="true"></app-stock-link-and-tradingview-link>
            </td>

            <td>{{ position.numberOfShares }}</td>
            <td>{{ position.bid | currency }}</td>
            <td>{{ position.price | currency }}</td>
            <td>{{ position.percentDiffBetweenBidAndPrice | percent }}</td>
            <td>{{ position.stopPrice | currency }}</td>
            <td>{{ position.date | date }}</td>
            <td class="text-end">
              <button class="btn btn-warning btn-sm" (click)="closePendingPosition(position)">Close</button>
            </td>
          </tr>
          <tr>
            <td colspan="8">
              {{ position.notes }}
              <div>
                <span class="badge bg-light text-secondary m-1">{{position.strategy}}</span>
              </div>
            </td>
          </tr>
          <tr>
            <td colspan="8">
              <app-brokerage-orders [filteredTickers]="[position.ticker]" [justOrders]="true" ></app-brokerage-orders>
            </td>
          </tr>
        </ng-container>

      </tbody>
    </table>
  </div>
</section>
